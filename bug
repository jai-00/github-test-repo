made some changes in the bug fix in the initial bug fix commit.
made some bug fixes in the main code.
